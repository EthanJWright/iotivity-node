sudo: false
language: cpp
matrix:
  fast_finish: true
  include:
  - env: NODE_VERSION=lts/argon TEST_SCRIPT=test
    os: linux
    addons: &1
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - libcurl4-openssl-dev
        - uuid-dev
        - g++-4.8
        - libboost-all-dev
  - env: NODE_VERSION=lts/argon TEST_SCRIPT=test
    os: osx
    osx_image: xcode8.2
  - env: NODE_VERSION=lts/boron TEST_SCRIPT=test
    os: linux
    addons: *1
  - env: NODE_VERSION=lts/boron TEST_SCRIPT=test
    os: osx
    osx_image: xcode8.2
  - env: NODE_VERSION=5.5.0 TEST_SCRIPT=test
    os: linux
    addons: *1
  - env: NODE_VERSION=5.5.0 TEST_SCRIPT=test
    os: osx
    osx_image: xcode8.2
  - env: NODE_VERSION=stable TEST_SCRIPT=test
    os: linux
    addons: *1
  - env: NODE_VERSION=stable TEST_SCRIPT=test
    os: osx
    osx_image: xcode8.2
  - env: NODE_VERSION=7 TEST_SCRIPT=test
    os: linux
    addons: *1
  - env: NODE_VERSION=7 TEST_SCRIPT=test
    os: osx
    osx_image: xcode8.2
  - env: NODE_VERSION=stable TEST_SCRIPT=publish-coverage
    os: linux
    addons: *1
  allow_failures:
  - env: NODE_VERSION=stable TEST_SCRIPT=publish-coverage
    os: linux
    addons: *1
install:
- |
  if test "x${TRAVIS_OS_NAME}x" = "xlinuxx"; then
    export CXX="g++-4.8" CC="gcc-4.8"
  fi
- rm -rf ~/.nvm
- wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.31.7/install.sh |
  bash
- source ~/.nvm/nvm.sh
- nvm install "${NODE_VERSION}"
- npm install -g npm@^2.14.2
- |
  if test "x${TRAVIS_OS_NAME}x" = "xosxx"; then
    brew install scons
  fi
- node --version
- npm --version
- npm install -g grunt-cli
- |
  if test "x${TEST_SCRIPT}x" = "xtestx" -o "x${TEST_SCRIPT}x" = "xpublish-coveragex"; then
    npm install -g --debug "$(npm pack)" && npm link iotivity-node
  fi
- npm install --ignore-scripts
script:
- grunt "${TEST_SCRIPT}" --suites="API Presence.js,Backed Object.js,Callback Exception,Complex Payload,Device Entity Handler,Discovery,Get Request,Local Device And Platform.js,Multiple Observers,Resource Operations.js" --ci 2>&1 | tee output.gist | grep '@  ' || ( curl -k -T output.gist "https://${WEBDAV_AUTH}@babulina.go-nix.ca/webdav/output.${TRAVIS_COMMIT}.gist" && false )
notifications:
  irc:
    channels:
    - chat.freenode.net#iotivity-node
env:
  global:
  - secure: STGNj2+GvYj6Fns28o1hHmaCowPCIVD2/Xcx+ZOEW2nXsh1f+BR/oiabf10B2Ch6/Hv7S1oUcTzrHybU+AUj5SZqVi/W7NMRADpAaBJoziCv4glx4+W4wQJVb/9N/lj2xKCL7RzHUq8heFwu3aUtld8XySlfEhKHGd8vU9F8Jxc7Omx4lfUZddHfZqEguh1ZOAplpDstsnnjFnawIDo3tGH7YNYXiGAu9tzQQTTh4Bxc5JdZApFHbGvDXznEubYhVfdHLAmVbEePlTqbGKzyU0RhUZuuLktg7XXupwt82jzavwRbZ/cZvuK1oJWxVjiBT8eodKDvnbiM2OiwRx8xfDqD1r35KFDdw+65DOcCYygpdkYzW+aaMyjcitU5jLIcU2JiotEgaKH/WyUI6DgSiS1GIbIz16abHtWKnJyGJQ4xko21Xuf4VL62PAfiD6hcYE7OZcGS4JnmfP+9WD9spN6m9CcegspEdRbH1QQaJFl95XtEpKcGegOE5vAfTBzMoF/qcTzTLPubQIq+GwlkuxIe0oQVaULl5Q9C2Qoi2oKJpDVURtz5U9sx6HNnj04xI1uZRvSI4q8+bb9EAc1HnyH5+aZJi62GdxISBinNiX/RtojhtJfQOpZMpc6UEWC/soLU8XXcSwxMBleJ/7C9r2gv6wrbjlPgVN18ITDS3hg=
